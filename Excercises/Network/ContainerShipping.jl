using JuMP, Gurobi

#############################################
# PARAMETERS
# Arc costs
c= [ 0.0 450.0 300.0 2200.0 6500.0 10500.0 19500.0 20000.0 16000.0 8800.0 6200.0
450.0 0.0 500.0 2400.0 6600.0 10700.0 19700.0 20200.0 16200.0 9000.0 6400.0
300.0 500.0 0.0 2100.0 6400.0 10400.0 19400.0 19900.0 15800.0 8600.0 6100.0
2200.0 2400.0 2100.0 0.0 5200.0 8500.0 16500.0 17000.0 15000.0 8200.0 6500.0
6500.0 6600.0 6400.0 5200.0 0.0 5800.0 10200.0 10800.0 13500.0 15000.0 11000.0
10500.0 10700.0 10400.0 8500.0 5800.0 0.0 3800.0 4600.0 14100.0 16700.0 15500.0
19500.0 19700.0 19400.0 16500.0 10200.0 3800.0 0.0 900.0 10400.0 12500.0 19000.0
20000.0 20200.0 19900.0 17000.0 10800.0 4600.0 900.0 0.0 9800.0 12000.0 18500.0
16000.0 16200.0 15800.0 15000.0 13500.0 14100.0 10400.0 9800.0 0.0 4800.0 6300.0
8800.0 9000.0 8600.0 8200.0 15000.0 16700.0 12500.0 12000.0 4800.0 0.0 3500.0
6200.0 6400.0 6100.0 6500.0 11000.0 15500.0 19000.0 18500.0 6300.0 3500.0 0.0]

# Connection and their costs
arcs_limit = [
    0 800 0 0 0 0 0 0 0 0 900;
    0 0 800 0 1200 0 0 0 0 0 0;
    0 0 0 800 0 0 0 0 0 0 0;
    800 0 0 0 1100 0 0 0 0 0 0;
    0 0 0 0 0 1100 1200 0 0 0 0;
    0 1200 0 1100 0 0 1400 0 0 0 0;
    0 0 0 0 0 1200 0 1400 1000 0 0;
    0 0 0 0 0 1400 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0 1000 0;
    900 0 0 0 0 0 0 0 0 0 1000;
    0 0 0 0 0 0 1000 0 0 900 0;

]

# Number of ports
N = size(arcs_limit, 1)

# Demand at each port
demand = [
# d1    d2    d3    d4    d5    d6    d7    d8
  0    400    0     0     0    440    0     0 ;   # 1 Rotterdam
 480     0     0     0     0     0    520    0 ;   # 2 Hamburg
  0      0    320    0     0     0     0     0 ;   # 3 Felixstowe
  0      0     0     0     0     0     0   -300;  # 4 Algeciras
  0      0   -320    0     0     0     0     0 ;   # 5 Jebel Ali
  0   -400    0     0    360    0     0     0 ;   # 6 Singapore
 -480    0     0    560    0     0     0     0 ;   # 7 Shanghai
  0      0     0     0     0     0     0    300;  # 8 Busan
  0      0     0     0     0     0   -520    0 ;   # 9 Los Angeles
  0      0     0     0   -360    0     0     0 ;   # 10 Panama
  0      0     0   -560    0   -440    0     0     # 11 New York
]

K = size(demand, 2)  # Number of container types

###########################################

#############################################
# MODEL
CS = Model(Gurobi.Optimizer)

# Decision variables
@variable(CS, 0 <= x[1:N,1:N,1:K])

for i in 1:N, j in 1:N, k in 1:K
        if arcs_limit[i,j] == 0
        fix(x[i,j,k], 0.0; force = true)
        end
    end

@objective(CS, Min, sum(0.01 * c[i,j] * x[i,j,k] for i=1:N, j=1:N, k=1:K))

@constraint(CS, [n=1:N, k=1:K], sum(x[i,n,k] for i=1:N) - sum(x[n,j,k] for j=1:N) == -demand[n,k])

@constraint(CS, [i=1:N,j=1:N], sum(x[i,j,k] for k=1:K) <= arcs_limit[i,j])


 # SOLVE
optimize!(CS)
if termination_status(CS) == MOI.OPTIMAL
        println("Optimal objective value: $(objective_value(CS))")
    else
        println("No optimal solution available")
end    
